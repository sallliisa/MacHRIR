## Core audio pipeline findings

- HRIR processing drops tail frames when `frameCount` is not a multiple of `processingBlockSize` (512). `processAudio` only processes full blocks, leaving the remainder silent. This can create periodic glitches depending on buffer size. Add a remainder path (partial block handling or zero-pad into a temp block). `Airwave/HRIRManager.swift`
- `AudioGraphManager`’s render callback always zeros all output channels and only writes when `selectedOutputChannelRange` is set. If that range is nil (e.g., no output selected, or future code path forgets to set it), output becomes silent. Consider a safe default to channels 0–1 or explicit error handling. `Airwave/AudioGraphManager.swift`
- `AudioGraphManager` allocates per-channel float buffers in `inputChannelBufferPtrs`, but later overwrites those pointers with `inputAudioBuffersPtr` in the render callback. The original allocated buffers become unused, adding memory overhead and making ownership confusing. Either use the allocated float buffers or remove them and keep a single pointer array. `Airwave/AudioGraphManager.swift`
- `Resampler.resampleHighQuality` uses `vDSP_vgenp` with a control vector but includes uncertainty about index semantics (comment notes possible 1‑based indexing). If the indices are off by one, resampling will be shifted or distorted. Confirm expected index base for `vDSP_vgenp` and adjust (or switch to `vDSP_vlint` with explicit control). `Airwave/Resampler.swift`
- `HRIRManager` caches renderer state with a static struct inside `processAudio` (not actually thread‑local). This is fine for a single audio thread but can become a data race if called concurrently (e.g., multiple audio units or offline render). Consider a `ThreadLocal` wrapper or document single‑thread assumption. `Airwave/HRIRManager.swift`
- `HRIRManager` clears `activePreset` twice in a couple of places, which looks like a leftover and suggests inconsistent state handling. Clean up duplicated assignments and centralize reset. `Airwave/HRIRManager.swift`
